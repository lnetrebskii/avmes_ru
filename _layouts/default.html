<!doctype html>
<html class="dark" lang="{{site.active_lang}}">
  <head>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="{{ '/assets/css/dist-style.css' | relative_url }}" rel="stylesheet" />
    <link href="{{ '/assets/css/fonts.css' | relative_url }}" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js"></script>
    <script>
      const { animate, scroll } = Motion
    </script>

    {% seo %}
    {% include custom_head.html %}
  </head>

  <body class="bg-neutral-50 text-neutral-900 dark:bg-neutral-950 dark:text-neutral-200">

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
      (function(m,e,t,r,i,k,a){
          m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
          m[i].l=1*new Date();
          for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
          k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
      })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105258448', 'ym');
      ym(105258448, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/105258448" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    {% include navbar.html %} 
      {{ content }} 
    {% include footer.html %}
    <script>
      document.querySelectorAll("a").forEach(function (link) {
        const opensInNewTab = link.getAttribute("target") === "_blank";
        const noAnimation = link.hasAttribute("data-no-animate");

        if (opensInNewTab || noAnimation) {
          return;
        }

        link.addEventListener("click", function (event) {
          event.preventDefault();
          link.classList.add("gentle-clicked");

          setTimeout(function () {
            link.classList.remove("gentle-clicked");
            window.location.href = link.href;
          }, 300);
        });
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize motion animations for all sections
        const motionElements = document.querySelectorAll('[data-motion]');
        
        motionElements.forEach(element => {
          const animationType = element.getAttribute('data-motion');
          const onScroll = element.getAttribute('data-motion-onscroll') !== 'false';
          
          // Handle stagger cards differently
          if (animationType === 'stagger-cards') {
            const cards = element.children;
            Array.from(cards).forEach((card, index) => {
              card.style.opacity = '0';
              card.style.transform = 'translateY(30px)';
            });
          } else {
            // Set initial state for regular animations
            element.style.opacity = '0';
            element.style.transform = getInitialTransform(animationType);
          }
          
          if (onScroll) {
            // Create intersection observer for scroll-triggered animations
            const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                if (entry.isIntersecting) {
                  animateElement(entry.target, animationType);
                  observer.unobserve(entry.target);
                }
              });
            }, { threshold: 0.2 });
            
            observer.observe(element);
          } else {
            // Animate immediately if not dependent on scroll
            animateElement(element, animationType);
          }
        });
        
        function getInitialTransform(type) {
          switch(type) {
            case 'fadeInLeft':
              return 'translateX(-100px)';
            case 'fadeInRight':
              return 'translateX(100px)';
            case 'fadeInUp':
              return 'translateY(50px)';
            case 'fadeInDown':
              return 'translateY(-50px)';
            default:
              return 'translateY(0)';
          }
        }
        
        function animateElement(element, type) {
          // Get custom delay and duration from data attributes
          const customDelay = parseFloat(element.getAttribute('data-motion-delay')) || 0;
          const customDuration = parseFloat(element.getAttribute('data-motion-duration')) || (type === 'stagger-cards' ? 0.6 : 0.8);
          
          if (type === 'stagger-cards') {
            // Animate cards with stagger effect
            const cards = Array.from(element.children);
            cards.forEach((card, index) => {
              Motion.animate(card, 
                { 
                  opacity: [0, 1],
                  transform: ['translateY(30px)', 'translateY(0)']
                },
                { 
                  duration: customDuration,
                  delay: customDelay + (index * 0.1),
                  easing: 'ease-out'
                }
              );
            });
          } else {
            // Regular animations with custom delay and duration
            Motion.animate(element, 
              { 
                opacity: [0, 1],
                transform: [getInitialTransform(type), 'translate(0, 0)']
              },
              { 
                duration: customDuration,
                delay: customDelay,
                easing: 'ease-out'
              }
            );
          }
        }
      });
    </script>
    <script>
      // Theme switcher functionality
      document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        
        // Check for saved theme preference or default to 'dark'
        const savedTheme = localStorage.getItem('theme');
        const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        const currentTheme = savedTheme || systemPreference;
        
        // Apply the current theme
        if (currentTheme === 'dark') {
          htmlElement.classList.add('dark');
        } else {
          htmlElement.classList.remove('dark');
        }
        
        // Theme toggle event listener
        if (themeToggle) {
          themeToggle.addEventListener('click', function() {
            if (htmlElement.classList.contains('dark')) {
              htmlElement.classList.remove('dark');
              localStorage.setItem('theme', 'light');
            } else {
              htmlElement.classList.add('dark');
              localStorage.setItem('theme', 'dark');
            }
          });
        }
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
          if (!localStorage.getItem('theme')) {
            if (e.matches) {
              htmlElement.classList.add('dark');
            } else {
              htmlElement.classList.remove('dark');
            }
          }
        });
      });

      document.querySelectorAll(".inout > div").forEach((item) => {
        scroll(animate(item, { opacity: [0, 1, 1, 0] }), {
            target: item,
            offset: ["start end", "end end", "start start", "end start"],
        })
      })
    </script>

    <!-- Booking Widget -->
    <script>
      (function() {
        // Функция инициализации виджетов
        function initializeBookingWidgets() {
          if (typeof BookingWidget === 'undefined') {
            console.warn('BookingWidget is not loaded yet');
            return;
          }

          const bookingButtons = document.querySelectorAll('[id^="book-btn-"]');
          
          bookingButtons.forEach(button => {
            const officeId = button.id.replace('book-btn-', '');
            
            try {
              BookingWidget.init({
                officeId: officeId,
                button: button
              });
              console.log('Initialized booking widget for office:', officeId);
            } catch (error) {
              console.error('Failed to initialize booking widget for office:', officeId, error);
            }
          });
        }

        // Загружаем скрипт виджета
        var script = document.createElement('script');
        script.src = 'https://arendavmeste.ru/widget/widget.js';
        script.async = true;
        
        script.onload = function() {
          console.log('BookingWidget script loaded successfully');
          // Инициализируем после загрузки скрипта
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeBookingWidgets);
          } else {
            initializeBookingWidgets();
          }
        };
        
        script.onerror = function() {
          console.error('Failed to load BookingWidget script');
        };
        
        document.head.appendChild(script);
      })();
    </script>
    <!-- /Booking Widget -->
  </body>
</html>
